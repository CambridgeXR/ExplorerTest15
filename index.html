<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimal-ui">
  <meta name="theme-color" content="#000000">
  <title>VR Explorer</title>
  <link rel="manifest" href="manifest.json">
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <style>
    body {
      margin: 0;
      background-color: #000;
      color: #fff;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      height: 100vh;
    }
    h1 { margin-top: 20px; }
    h2 { margin-top: 30px; }
    .section { margin-bottom: 40px; width: 90%; max-width: 600px; text-align: center; }
    select { width: 100%; padding: 8px; margin-top: 5px; font-size: 1rem; }
    #or-text { font-weight: bold; margin: 10px 0; }
    .button {
      margin-top: 10px;
      padding: 12px 24px;
      font-size: 1rem;
      background-color: grey;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .button.active { background-color: #4CAF50; }
    .safe-mode { display: flex; justify-content: center; align-items: center; margin: 5px 0; }
    .safe-mode input[type="radio"] { display: none; }
    .safe-mode label {
      padding: 8px 16px;
      border-radius: 20px;
      border: 2px solid #4CAF50;
      cursor: pointer;
      margin: 0 10px;
    }
    .safe-mode input[type="radio"]:checked + label {
      background-color: #4CAF50;
      color: white;
    }
    footer { font-size: 0.8rem; font-style: italic; margin-bottom: 20px; }
    #ipd-slider-container { display: none; margin-top: 10px; }
  </style>
</head>
<body>

  <!-- Main Title -->
  <div class="section">
    <h1>VR Explorer</h1>
  </div>

  <!-- Step 1: Select Simulation -->
  <div class="section">
    <h2>Step 1: Select Simulation</h2>
    <div>
      <div>
        <label for="audience-select">Presentation Audiences:</label>
        <select id="audience-select">
          <option value="">--select option--</option>
        </select>
      </div>
      <div id="or-text">or</div>
      <div>
        <label for="scenario-select">Special Scenarios:</label>
        <select id="scenario-select">
          <option value="">--select option--</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Step 2: Enter Simulation -->
  <div class="section">
    <h2>Step 2: Enter Simulation</h2>
    <button id="go-button" class="button">Go</button>
    <div id="ipd-slider-container">
      <input type="range" id="ipd-slider" min="0.5" max="1.5" step="0.01" value="1">
    </div>
  </div>

  <!-- Optional Settings -->
  <div class="section">
    <h3>Optional Settings</h3>
    <div class="safe-mode">
      <input type="radio" id="safe1" name="safe-mode" value="android">
      <label for="safe1">Safe Mode 1</label>

      <input type="radio" id="safe2" name="safe-mode" value="vr-ipd">
      <label for="safe2">Safe Mode 2</label>
    </div>
  </div>

  <!-- Footer -->
  <footer class="section">
    VR Explorer 1.1 brought to you by Cambridge VR
  </footer>

  <script>
    // ================================
    // Video Links
    // ================================
    const audienceVideos = {
      "Audience of 0": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N0-CF.h264.mp4",
      "Audience of 1": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N1-CF.h264.mp4",
      "Audience of 2": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N2-CF.h264.mp4",
      "Audience of 4": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N4-CF.h264.mp4",
      "Audience of 9": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N9-CF.h264.mp4",
      "Audience of 16": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N16-CF.h264.mp4",
      "Audience of 25": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N25-CF.h264.mp4",
      "Audience of 50": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N50-CF.h264.mp4",
      "Audience of 100": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N100-CF.h264.mp4",
      "Audience of 500": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N500-CF.h264.mp4",
      "Audience of 1000s": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N10K-CF.h264.mp4"
    };

    const scenarioVideos = {
      "TV teleprompter": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/ACC01-CF.h264.mp4",
      "Job interview": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/JIC01-CF.h264.mp4",
      "Radio interview": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/RIC01-CF.h264.mp4"
    };

    // ================================
    // Populate dropdowns
    // ================================
    const audienceSelect = document.getElementById('audience-select');
    const scenarioSelect = document.getElementById('scenario-select');

    Object.keys(audienceVideos).forEach(key => {
      const opt = document.createElement('option');
      opt.value = key;
      opt.textContent = key;
      audienceSelect.appendChild(opt);
    });

    Object.keys(scenarioVideos).forEach(key => {
      const opt = document.createElement('option');
      opt.value = key;
      opt.textContent = key;
      scenarioSelect.appendChild(opt);
    });

    // ================================
    // Go button logic
    // ================================
    const goButton = document.getElementById('go-button');
    const ipdSliderContainer = document.getElementById('ipd-slider-container');

    function getSelectedVideo() {
      return audienceSelect.value ? audienceVideos[audienceSelect.value] :
             scenarioSelect.value ? scenarioVideos[scenarioSelect.value] :
             null;
    }

    // Highlight Go button only when a selection is made
    function updateGoButton() {
      goButton.classList.toggle('active', !!getSelectedVideo());
    }

    audienceSelect.addEventListener('change', () => {
      scenarioSelect.value = ""; // only one selection at a time
      updateGoButton();
    });
    scenarioSelect.addEventListener('change', () => {
      audienceSelect.value = "";
      updateGoButton();
    });

    // Safe Mode radio
    let safeMode = null;
    document.querySelectorAll('input[name="safe-mode"]').forEach(input => {
      input.addEventListener('change', () => {
        safeMode = input.value;
      });
    });

    // ================================
    // Go button click
    // ================================
    goButton.addEventListener('click', () => {
      const videoUrl = getSelectedVideo();
      if (!videoUrl) return;

      // Default Mode
      if (!safeMode) {
        // Open A-Frame scene in full screen
        const scene = document.createElement('a-scene');
        scene.setAttribute('embedded', '');
        scene.setAttribute('vr-mode-ui', 'enabled: true');
        scene.setAttribute('renderer', 'antialias: true');
        scene.innerHTML = `
          <a-videosphere src="${videoUrl}" rotation="0 -90 0" autoplay loop></a-videosphere>
        `;
        document.body.innerHTML = '';
        document.body.appendChild(scene);
      }

      // Safe Mode 1: YouTube
      if (safeMode === 'android') {
        const youtubeUrl = videoUrl.replace('.mp4', ''); // placeholder: map to YouTube as needed
        window.open(youtubeUrl, '_blank');
      }

      // Safe Mode 2: VR with IPD slider
      if (safeMode === 'vr-ipd') {
        const scene = document.createElement('a-scene');
        scene.setAttribute('embedded', '');
        scene.setAttribute('vr-mode-ui', 'enabled: true');
        scene.setAttribute('renderer', 'antialias: true');
        scene.innerHTML = `
          <a-videosphere src="${videoUrl}" rotation="0 -90 0" autoplay loop></a-videosphere>
        `;
        document.body.innerHTML = '';
        document.body.appendChild(scene);
        ipdSliderContainer.style.display = 'block';
        const ipdSlider = document.getElementById('ipd-slider');
        ipdSlider.addEventListener('input', e => {
          const cam = scene.querySelector('a-camera');
          if (cam) cam.setAttribute('camera', 'userHeight', e.target.value);
        });
      }
    });

    updateGoButton();
  </script>
</body>
</html>
